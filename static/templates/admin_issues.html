<!-- templates/admin_issues.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Issues</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/reports.css') }}"
    />
  </head>
  <body>
    <div class="page-wrapper">
      <div class="nav-wrapper">
        <div class="grad-bar"></div>
        <nav class="navbar">
          <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </div>
          <ul class="nav no-search">
            <li class="nav-item">
              <a href="{{ url_for('auth.dashboard') }}">Home</a>
            </li>
            <li class="nav-item">
              <a href="{{ url_for('auth.logout') }}">Logout</a>
            </li>
          </ul>
        </nav>
      </div>
  <body>
    <div class="page-wrapper">
      <div class="admin-issues-container">
        <h1>All Reported Issues</h1>

        <!-- Flash Messages -->
        <div class="flash-messages">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                  {{ message }}
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
        </div>

        <table>
          <tr>
            <th>ID</th>
            <th>Reporter</th>
            <th>Description</th>
            <th>Location</th>
            <th>Image</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
          {% for issue in issues %}
            <tr>
              <td>{{ issue._id }}</td>
              <td>{{ issue.reporter_email }}</td>
              <td>{{ issue.description }}</td>
              <!-- After (new) -->
<td>
  <a 
    href="https://www.google.com/maps/search/?api=1&query={{ issue.location.lat }},{{ issue.location.lng }}"
    target="_blank"
    rel="noopener noreferrer"
  >
    Lat: {{ issue.location.lat }} Lng: {{ issue.location.lng }}
  </a>
</td>

              <td>
                {% if issue.image_path %}
                  <img
                    src="{{ url_for('static', filename=issue.image_path) }}"
                    alt="Issue Image"
                  />
                {% else %}
                  No image
                {% endif %}
              </td>
              <td>{{ issue.status }}</td>
              <td>
                <!-- Example: dropdown of maintenance users -->
                <form action="{{ url_for('reports.assign_issue', issue_id=issue._id) }}" method="POST">
                  <select name="maintenance_email">
                    <option value="">-- Select Maintenance --</option>
                    {% for m in maintenance_users %}
                      <option value="{{ m.email }}">
                        {{ m.name }} ({{ m.email }})
                      </option>
                    {% endfor %}
                  </select>
                  
                  <button type="submit">Assign</button>
                </form>
              </td>
              
              <td>
                <form
                  action="{{ url_for('reports.update_status', issue_id=issue._id) }}"
                  method="POST"
                >
                  <select name="status">
                    <option value="pending" {% if issue.status=='pending' %}selected{% endif %}>Pending</option>
                    <option value="approved" {% if issue.status=='approved' %}selected{% endif %}>Approved</option>
                    <option value="in_progress" {% if issue.status=='in_progress' %}selected{% endif %}>In Progress</option>
                    <option value="resolved" {% if issue.status=='resolved' %}selected{% endif %}>Resolved</option>
                  </select>
                  <button type="submit">Update</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </body>
</html>
