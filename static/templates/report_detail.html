<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Report {{ issue._id }}</title>

  <!-- Bootstrap & Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body, html { height: 100%; margin: 0; }
    .sidebar { width: 340px; max-width: 100%; height: 100vh; overflow-y: auto; }
    #detailMap { height: 100vh; width: 100%; }
  </style>
</head>
<body class="bg-light">

  <!-- Top navbar with mini icon items -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container-fluid">
      <!-- mobile toggler -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navMenu"
        aria-controls="navMenu"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a
            class="nav-link"
            href="{{ url_for('auth.dashboard') }}"
            title="Dashboard"
          >
            <i class="bi bi-speedometer2">Dashboard</i>
          </a>
        </li></ul>
      <!-- icon-only nav links -->
      <div class="collapse navbar-collapse" id="navMenu">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a
              class="nav-link"
              href="{{ url_for('main.home') }}"
              title="Home"
            >
              <i class="bi bi-house">Home</i>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="{{ url_for('auth.logout') }}"
              title="Logout"
            >
              <i class="bi bi-box-arrow-right">Logout</i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Back link -->
  <nav class="navbar navbar-light bg-white shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('reports.public_reports') }}">
        <i class="bi bi-arrow-left"></i> Back to all reports
      </a>
    </div>
  </nav>

  <div class="d-flex">
    <!-- SIDEBAR -->
    <aside class="sidebar bg-white p-4 border-end">
      <h4>{{ issue.city_street or issue.category or 'Report' }}</h4>

      <p class="text-muted small">
        Reported by <strong>{{ issue.reporter_email }}</strong><br>
        <span class="text-secondary">{{ issue.timestamp }}</span>
      </p>

      {% if issue.image_path %}
      <a href="#" data-bs-toggle="modal" data-bs-target="#imgModal">
        <img
          src="{{ url_for('static', filename=issue.image_path) }}"
          class="img-fluid rounded mb-3"
          alt="Issue image"
        >
      </a>
      {% endif %}

      <p>{{ issue.description }}</p>

      <p>
        <span class="badge bg-secondary text-capitalize">
          {{ issue.status }}
        </span>
      </p>

      {% if issue.location %}
      <a
        class="btn btn-sm btn-outline-primary mt-2"
        href="https://www.google.com/maps?q={{ issue.location.lat }},{{ issue.location.lng }}"
        target="_blank"
      >
        <i class="bi bi-geo-alt-fill me-1"></i> Open in Google Maps
      </a>
      {% endif %}
    </aside>

    <!-- MAP CONTAINER -->
    <div
      id="detailMap"
      {% if issue.location %}
        data-lat="{{ issue.location.lat }}"
        data-lng="{{ issue.location.lng }}"
      {% endif %}
      data-cat="{{ issue.category|e or 'Report' }}"
    ></div>
  </div>

  {% if issue.image_path %}
  <div class="modal fade" id="imgModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0">
        <button
          type="button"
          class="btn-close position-absolute end-0 top-0 m-3"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
        <img
          src="{{ url_for('static', filename=issue.image_path) }}"
          class="img-fluid rounded"
          alt="Issue image large"
        >
      </div>
    </div>
  </div>
  {% endif %}

  <!-- libs -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  ></script>
  <!-- our script -->
  <script src="{{ url_for('static', filename='js/report_detail.js') }}"></script>
</body>
</html>
